---
title: "A gravity model for the spatial spread of 2019-nCov in China"
output: html_document
date: "`r format(Sys.time(), '%B %d, %Y')`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
library(knitr)
library(dplyr)
```

## Introduction

We developed a gravity-based model to better understand the risk of spatial spread of the 2019-nCov at the prefecture level in China, and to determine the efficacy of quarantines imposed in Wuhan and other prefectures.


This model is calibrated using [data](https://ncov.dxy.cn/ncovh5/view/pneumonia?scene=2&clicktime=1579579384&enterid=1579579384&from=groupmessage&isappinstalled=0) of the first reported cases within each prefecture in China, with data sources crowd sourced from news stories and twitter.

Data of [quarantines](https://docs.google.com/spreadsheets/d/1cYqkGOy4ZjHSIeRqyfyi7UvYnG6-UlBAJWD8GMFZA7I/edit#gid=1525027375) and other travel restrictions were collated from various sources, including news reports, and Chinese government websites. A given prefecture was assumed under quarantine following the first date a quarantine or travel restriction was administered in a given prefecture. Interprovincial travel restrictions implemented in China are not currently included in the model, only those at the city or prefecture level.
                                                                                  
All findings are preliminary and subject to change, pending future changes in the underlying data.
These results have not been peer-reviewed, but have been prepared to a professional standard with the intention of providing useful information about a rapidly developing event. 

## Model

We use competing stochastic, mechanistic Susceptible-Infected (SI) models at the prefecture scale to predict the risk of 2019-nCov (EVD) importation into uninfected prefectures within China. The models are updated daily using date of the first reported case by prefecture (administrative level 2), provided by [link to data](https://ncov.dxy.cn/ncovh5/view/pneumonia?scene=2&clicktime=1579579384&enterid=1579579384&from=groupmessage&isappinstalled=0). 
 
The probabilities of importation to all susceptible zones $i$ from all infected zones $j$ (sources) are modelled using a logistic parameterization, with $P_{ij}$ defined as the probability of infection between prefectures $j$ and $i$ according to a set of two competing gravity models. Both models consider the distance between prefectures $d_{ij}$, the population sizes of the prefectures $p$, and the second includes an additional term when there is a quarantine or travel restriction in place between prefectures $j$ and $i$, $quarantine_{ij}$. 

### Model 1

\begin{equation}
P_{ij} = \frac{1}{1+e^{\beta_{0}+\beta_{1}\frac{d_{ij}}{p_ip_j^{\beta_{2}}}}}
\end{equation}


### Model 2

\begin{equation}
P_{ij} = 
    \begin{cases}\frac{1}{1+e^{\beta_{0}+\beta_{1}\frac{d_{ij}}{p_ip_j^{\beta_{2}}}2^{\beta3}}} & \text{ if crossing quarantine border} \\ \frac{1}{1+e^{\beta_{0}+\beta_{1}\frac{d_{ij}}{p_ip_j^{\beta_{2}}}}} & \text{ if not crossing quarantine border} \end{cases}
\end{equation}
    
Parameter estimation was performed using the Nelder-Mead optimization algorithm of the negative log likelood. Model selection is performed using AIC. 

```{r, parameter table, echo = FALSE}
Model1 <- c("distance, populations", 5.03, 289.65, 0.41, "---", 1837.38)
Model2 <- c("distance, populations, and quarantine", 4.87, 8145.28, 0.51, -3.85, 1829.47)

text_tbl1 <- NULL

text_tbl1 <- rbind(text_tbl1, Model1, Model2)
colnames(text_tbl1) <- c("Predictors", "beta0", "beta1", "beta2", "beta3", "AIC")

#creates a table 
kable(text_tbl1, row.names = NA, caption = "Model output") %>%
  kable_styling(full_width = F) %>%
  column_spec(1, width = "8em") %>%
  column_spec(2, width = "8em") %>%
  column_spec(3, width = "4em") %>%
  column_spec(4, width = "4em") %>%
  column_spec(5, width = "3em") %>%
  column_spec(6, width = "10em")
```



## Discussion

The model with the lowest AIC included quarantine borders but the parameter estimates suggest that the quarantines were ineffective at slowing the rate of spread of the nCov within China. In fact, according to the model, prefectures with quarantines are associated with increased transmission risk. This could be a signal of extensive unobserved spread of the disease prior to the quarantines going into effect, although more than one infectious period has passed since the initial quarantine in Wuhan.

Alternatively, since we are not currently including the number of cases in each prefecture at each time step, it is likely that the prefectures that contain quarantines are simply prefectures that have the highest case load, and that including the quarantines in the model is identifying the most infectious prefectures as having the highest risk of transmitting the disease prior to and potentially during the quarantines.

Additionally, the model implies that the quarantines put in place were not effective at slowing the spread of disease within China, but we are making no conclusions about international spread or efficacy of international quarantines or restrictions.

We will extend the model to include the number of daily reported cases in the estimation of transmission risk. This may improve our ability to estimate risk, but it also introduces additional error from under-reporting of cases during the initial spread.

## Details

Additional model details are available online at...